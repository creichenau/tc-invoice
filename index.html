<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>T&K Services Field Ticket</title>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js">
    </script>
    <script type="text/javascript">
        (function () {
            emailjs.init({
                publicKey: "u2kD264US6flsgLA0",
            });
        })();
    </script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 1rem;
            background: #f5f5f5;
        }

        .form-container {
            max-width: 480px;
            margin: auto;
            background: white;
            padding: 1.25rem;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .invoice-container {
            height: 829px;
            width: 400px;
            margin: auto;
            background: white;
            padding: 1.25rem;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            position: relative;
        }

        label {
            display: block;
            margin-top: 1rem;
            font-weight: bold;
        }

        input,
        textarea {
            width: 95%;
            padding: 0.75rem;
            margin-top: 0.35rem;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 1rem;
        }

        .invoice-container input,
        textarea {
            width: 100px;
            height: 3px;
            position: absolute;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        button {
            margin-top: 1.5rem;
            width: 100%;
            padding: 0.9rem;
            background: #0078d4;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1.1rem;
        }

        #addLineItem {
            background: #28a745;
            margin-top: 1rem;
        }

        .form-background {
            background-image: url("images/invoice_form_v2.png");
            background-size: cover;
            /* fills the div */
            background-position: center;
            /* keeps it centered */
            background-repeat: no-repeat;
        }

        .amount {
            position: absolute;
            left: 367px;
        }
    </style>

</head>

<body>
    <form id="invoiceForm">
        <div class="invoice-container form-background">

            <input type="text" id="invoiceNumber" style="left: 258px; top: 56px; width: 140px;" required />
            <input type="date" id="invoiceDate" style="left: 258px; top: 94px; width: 140px;" required />
            <input type="text" id="companyName" style="left: 90px; top: 134px; width: 308px;" required />
            <input type="text" id="leaseNumber" style="left: 152px; top: 180px; width: 250px;" />
            <input type="text" id="loeNumber" style="left: 152px; top: 234px; width: 250px;" />
            <textarea id="jobDescription"
                style="left: 97px; top: 285px; width: 305px; height: 70px; min-height: 70px;"></textarea>
            <input type="text" id="woNumber" style="left: 115px; top: 389px; width: 286px;" />

            <input type="text" id="lineitem1_qty" style="left: 14px; top: 469px; width: 19px;"
                onchange="updateAmount()" />
            <input type="text" id="lineitem1_name" style="left: 64px; top: 469px; width: 205px;" />
            <input type="text" id="lineitem1_rate" style="left: 304px; top: 469px; width: 25px;"
                onchange="updateAmount()" />
            <span class="amount" id="amount1" style="top: 481px;">$0.00</span>

            <input type="text" id="lineitem2_qty" style="left: 14px; top: 512px; width: 19px;"
                onchange="updateAmount()" />
            <input type="text" id="lineitem2_name" style="left: 64px; top: 512px; width: 205px;" />
            <input type="text" id="lineitem2_rate" style="left: 304px; top: 512px; width: 25px;"
                onchange="updateAmount()" />
            <span class="amount" id="amount2" style="top: 524px;">$0.00</span>

            <input type="text" id="lineitem3_qty" style="left: 14px; top: 555px; width: 19px;"
                onchange="updateAmount()" />
            <input type="text" id="lineitem3_name" style="left: 64px; top: 555px; width: 205px;" />
            <input type="text" id="lineitem3_rate" style="left: 304px; top: 555px; width: 25px;"
                onchange="updateAmount()" />
            <span class="amount" id="amount3" style="top: 567px;">$0.00</span>

            <input type="text" id="lineitem4_qty" style="left: 14px; top: 598px; width: 19px;"
                onchange="updateAmount()" />
            <input type="text" id="lineitem4_name" style="left: 64px; top: 598px; width: 205px;" />
            <input type="text" id="lineitem4_rate" style="left: 304px; top: 598px; width: 25px;"
                onchange="updateAmount()" />
            <span class="amount" id="amount4" style="top: 610px;">$0.00</span>

            <input type="text" id="lineitem5_qty" style="left: 14px; top: 640px; width: 19px;"
                onchange="updateAmount()" />
            <input type="text" id="lineitem5_name" style="left: 64px; top: 640px; width: 205px;" />
            <input type="text" id="lineitem5_rate" style="left: 304px; top: 640px; width: 25px;"
                onchange="updateAmount()" />
            <span class="amount" id="amount5" style="top: 652px;">$0.00</span>

            <input type="text" id="lineitem6_qty" style="left: 14px; top: 681px; width: 19px;"
                onchange="updateAmount()" />
            <input type="text" id="lineitem6_name" style="left: 64px; top: 681px; width: 205px;" />
            <input type="text" id="lineitem6_rate" style="left: 304px; top: 681px; width: 25px;"
                onchange="updateAmount()" />
            <span class="amount" id="amount6" style="top: 693px;">$0.00</span>

            <span class="amount" id="amountSubtotal" style="top: 752px; left: 323px;">$0.00</span>
            <span class="amount" id="amountTax" style="top: 796px; left: 323px;">$0.00</span>
            <span class="amount" id="amountTotal" style="top: 836px; left: 323px;">$0.00</span>
        </div>
        <div class="form-container">
            <button type="submit">Submit Invoice</button>
        </div>
    </form>
    <script>

        function updateAmount() {
            let subTotal = 0;
            for (let i = 1; i < 7; i++) {
                let qty_el = document.getElementById('lineitem' + i + '_qty');
                let qty = parseFloat(qty_el.value) || 0;
                let rate_el = document.getElementById('lineitem' + i + '_rate');
                let rate = parseFloat(rate_el.value) || 0;
                let amount = qty * rate;
                document.getElementById('amount' + i).textContent = `$${amount.toFixed(2)}`;
                subTotal = subTotal + amount;
            }
            document.getElementById('amountSubtotal').textContent = `$${subTotal.toFixed(2)}`;

            let taxAmount = subTotal * 0.0825;
            let totalAmount = subTotal + taxAmount;
            document.getElementById('amountTax').textContent = `$${taxAmount.toFixed(2)}`;
            document.getElementById('amountTotal').textContent = `$${totalAmount.toFixed(2)}`;
        }


        document.getElementById("invoiceForm").addEventListener("submit", function (e) {
            e.preventDefault();

            const lineItems = [];
            for (let i = 1; i <= 6; i++) {
                let qty = parseFloat(document.getElementById('lineitem' + i + '_qty').value) || 0;
                if (qty > 0) {
                    lineItems.push({
                        quantity: qty,
                        rate: parseFloat(document.getElementById('lineitem' + i + '_rate').value) || 0,
                        name: document.getElementById('lineitem' + i + '_name').value
                    });
                }
            }
            const data = {
                companyName: companyName.value,
                invoiceNumber: invoiceNumber.value,
                invoiceDate: invoiceDate.value,
                leaseNumber: leaseNumber.value,
                woNumber: woNumber.value,
                jobDescription: jobDescription.value,
                lineItems: lineItems
            };

            console.log("Invoice Submitted:", data);

            emailjs.send("service_ffzq9qn", "template_pr8w3ob", data)
                .then(() => {
                    alert("Invoice submitted successfully");
                    setTimeout(() => {
                        location.reload();
                    }, 5000);
                })
                .catch(err => alert("Error sending email: " + err));
        });
    </script>

</body>

</html>